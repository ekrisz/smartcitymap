extends layout.pug
block content
    #map
    //- #leg_title 
    //-     span#leg_items Map Legend
    //- #leg
    //-     each layer, i in coordinates
    //-         input(id=layer.name, type='checkbox', checked)
    //-         span#leg_items #{layer.name}
    //-         br


    script(type='text/javascript').
        //- var L = require('leaflet');
        var map = L.map('map').setView([#{lat},#{lng}], 14);

        L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', {
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a> &copy; <a href="https://carto.com/attributions">CARTO</a>',
            subdomains: 'abcd',
            maxZoom: 21
        }).addTo(map);
    each item in items
        script(type='text/javascript').
           
            L.circleMarker([!{item.coordinate}]).addTo(map)
                .bindPopup(
                    '<p>Battery: ' + !{item.description} + '</p>'
                );
               
            


    //- script(type='text/javascript').
    //-     var map = L.map('map').setView([#{lat},#{lng}], 14);
    //-     L.tileLayer('http://{s}.tile.osm.org/{z}/{x}/{y}.png', {
    //-         attribution: '&copy; <a href="http://osm.org/copyright">OpenStreetMap</a> contributors'
    //-     }).addTo(map);
        
    //-     $.getJSON('/maplayers',function(result){
    //-         $.each(result, function(i, mlayer){
    //-             $.getJSON('/mapjson/' + mlayer.name, function(data) { addLayer(coordinates, mlayer.name ) });
    //-         });
    //-     });

    //-     function addLayer(layer, name) {
    //-         var leaf_layer;
    //-         if (layer.type == "MultiPoint") {
    //-             leaf_layer = L.geoJson(layer, { pointToLayer: function (feature, latlng) {return L.circleMarker(latlng, layer.style); }});
    //-             leaf_layer.bindPopup("hi");
    //-         } else if (layer.type == "MultiLineString") {
    //-             leaf_layer = L.geoJson(layer, {style: layer.style });
    //-             leaf_layer.bindPopup(layer.type);
    //-         } else  {
    //-             leaf_layer = L.geoJson(layer, {
    //-                 style: function(feature) {
    //-                     switch (feature.properties.style) {
    //-                     case 'Orange': return {color: "#ff0000"};
    //-                     case 'Blue': return {color: "#0000ff"};
    //-                 }
    //-                 },
    //-                 onEachFeature: function (feature, layer) {
    //-                         layer.bindPopup(feature.properties.name);
    //-                     }
    //-                 });
    //-         }
    //-         leaf_layer.addTo(map);
            
    //-         $('#' + name).click(function(e) {
                
    //-             if (map.hasLayer(leaf_layer)) {
    //-                 map.removeLayer(leaf_layer);
    //-             } else {
    //-                 map.addLayer(leaf_layer);
    //-             }
    //-         });
    //-     }